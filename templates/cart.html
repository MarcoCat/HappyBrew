{% extends "base.html" %}

{% block content %}
<main>
    <h1 class="cartTitle">Cart</h1>
    <p class="processWord"> You are almost done! </p>
  
    <div class="cartPageLU">
        {% for order in orders %}
        <section>
            <h2>Order {{ order.id }}</h2>
            <p>Name: {{ order.name }}</p>
            <p>Address: {{ order.address }}</p>
            <table class="cartTable">
                <thead>
                    <tr>
                        <th>Item</th>
                        <th>Quantity</th>
                        <th>Price</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product_order in order.products %}
                    <tr>
                        <td>{{ product_order.product.name }}</td>
                        <td>{{ product_order.quantity }}</td>
                        <td>{{ product_order.product.price }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
        {% endfor %}
        <section class="sumArea">
            <img
            src="{{ url_for('static', filename='image/cartPage/cuteBubbleTeaCart.png') }}"
            alt="4 bubble tea images"
            width="85"
            height="45"
            />
            <h3>Total price:</h3>
            <p id="total-price" class="sumPrice">$ {{ "{:.2f}".format(total) }}</p>
            <div class="cartButton">
                <a class = "checkoutLink" href="checkout">Ready to Checkout!</a>
                <a class = "backMenuLink" href="menu">Back to menu</a>
            </div>
        </section>
        
    </div>

</main>
<script>
  // Retrieve cart from local storage, parse it and store in the variable cart
  let cart = JSON.parse(localStorage.getItem('cart')) || [];

  // Render cart items
  function renderCartItems() {
    const cartTable = document.querySelector('.cartTable tbody');
    cartTable.innerHTML = '';
  
    let totalPrice = 0;
  
    cart.forEach(item => {
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${item.name}</td>
        <td>${item.quantity}</td>
        <td>${item.price}</td>
      `;
      cartTable.appendChild(row);
  
      totalPrice += item.price * item.quantity;
    });
  
    // Update the total price element
    document.getElementById('total-price').textContent = '$ ' + totalPrice.toFixed(2);
  }
  
  // Call the renderCartItems function when the page loads
  renderCartItems();
  function appendCartItemsToForm() {
    const form = document.getElementById('checkout-form');
  
    cart.forEach((item, index) => {
      const nameInput = document.createElement('input');
      nameInput.type = 'hidden';
      nameInput.name = `products[${index}][name]`;
      nameInput.value = item.name;
      form.appendChild(nameInput);
  
      const quantityInput = document.createElement('input');
      quantityInput.type = 'hidden';
      quantityInput.name = `products[${index}][quantity]`;
      quantityInput.value = item.quantity;
      form.appendChild(quantityInput);
    });
  }
  
  // Call the appendCartItemsToForm function when the page loads
  appendCartItemsToForm();
  
</script>
{% endblock %}
